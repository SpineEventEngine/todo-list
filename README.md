# todo-list

[![Codacy Badge](https://api.codacy.com/project/badge/Grade/39e3e7d9707f4da58c950c3dbf172cfd)](https://www.codacy.com/app/SpineEventEngine/todo-list?utm_source=github.com&utm_medium=referral&utm_content=SpineEventEngine/todo-list&utm_campaign=badger)

ToDo List example application

---

# Guide

## Step 1

In this step, we start developing the system.

### Model

First, we define the domain model in the `model` module. This includes defining:
 - [`Task`](./model/src/main/proto/todolist/model.proto) aggregate state type;
 - [commands](./model/src/main/proto/todolist/c/commands.proto), [events](./model/src/main/proto/todolist/c/events.proto), 
  and [rejections](./model/src/main/proto/todolist/c/rejections.proto) relevant to this aggregate;
 - DTO types relevant to `Task` type ([`attributes.proto`](./model/src/main/proto/todolist/attributes.proto),
  [`values.proto`](./model/src/main/proto/todolist/values.proto),
  [`changes.proto`](./model/src/main/proto/todolist/changes.proto));
 - `TaskId` - the aggregate identifier (in a separate file [`identifier.proto`](./model/src/main/proto/todolist/identifiers.proto));
 - custom validation rules for the `...Change` types ([`validation_rules.proto`](./model/src/main/proto/todolist/validation_rules.proto)).
 
### Entities
 
After the model is defined, we create Java classes for [`TaskAggregate`](./api-java/src/main/java/io/spine/examples/todolist/c/aggregate/TaskAggregate.java)
and [`TaskRepository`](./api-java/src/main/java/io/spine/examples/todolist/repository/TaskRepository.java).

In the `TaskAggregate` class we define command and event handler methods.
Command handler methods either return events or throw command rejections.
Event handler methods alter the aggregate state.
Note that the event handlers do not validate the events, since those are supposedly generated by 
same aggregate instance. 

### Bounded Contexts

Also, in this step we create the [`BoundedContexts`](./api-java/src/main/java/io/spine/examples/todolist/context/BoundedContexts.java) â€”
the `BoundedContext` factory.

The factory creates proper instances of TodoList bounded context (which is currently the only 
bounded context in the application). The instances have a `TaskRepository` registered. In next steps,
all the new entity repositories will be registered in TodoList bounded context.

`BoundedContexts.create(StorageFatory)` method creates `BoundedContext`s with the given storage 
implementation.

### Storage and Deployment

All the deployment configurations are placed under the [`deployment`](./deployment) directory.

For a quick start, we create a local server with an in-memory storage. But first, we add a [wrapper](./server/src/main/java/io/spine/examples/todolist/server/Server.java) 
for Spine gRPC services: `CommandService`, `QueryService`, and `SubscriptionService`.

Then, we add the [`LocalInMemoryServer`](./deployment/local-inmem/src/main/java/io/spine/examples/todolist/server/LocalInMemoryServer.java),
which creates a `BoundedContext` with an in-mem storage and starts the server.

To launch the application at this point, we need to run the `LocalInMemoryServer.main()` method (for
example from IDE).

### Tests

For the purpose of testing, we create the [`testutil-api`](./testutil-api/src/main/java/io/spine/examples/todolist/testdata)
module, which contains a number of utilities for testing the `api-java` classes (i.e. 
the `TaskAggregate` class, etc.).

To write [tests for `TaskAggregate`](./api-java/src/test/java/io/spine/examples/todolist/c/aggregate/definition),
we extend the `AggregateCommandTest` and test the effect of
each separate command on the aggregate.

---

[Step 2](https://github.com/SpineEventEngine/todo-list/tree/step-2)
